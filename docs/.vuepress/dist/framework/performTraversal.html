<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ViewRootImpl 中 performTraversal() 梳理 | 本地煮鸡:8080</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="一个博客, 大概会记录一些技术笔记">
    
    <link rel="preload" href="/assets/css/0.styles.ecc20c62.css" as="style"><link rel="preload" href="/assets/js/app.f18c4670.js" as="script"><link rel="preload" href="/assets/js/3.1fb3b4b2.js" as="script"><link rel="preload" href="/assets/js/27.62efc4a2.js" as="script"><link rel="preload" href="/assets/js/5.5d16e667.js" as="script"><link rel="prefetch" href="/assets/js/10.c791a782.js"><link rel="prefetch" href="/assets/js/11.28b70681.js"><link rel="prefetch" href="/assets/js/12.5afd9efb.js"><link rel="prefetch" href="/assets/js/13.140c34f0.js"><link rel="prefetch" href="/assets/js/14.7d326419.js"><link rel="prefetch" href="/assets/js/15.8068ea95.js"><link rel="prefetch" href="/assets/js/16.67ec5bab.js"><link rel="prefetch" href="/assets/js/17.c86845e7.js"><link rel="prefetch" href="/assets/js/18.d9bb6a79.js"><link rel="prefetch" href="/assets/js/19.45ba0e69.js"><link rel="prefetch" href="/assets/js/20.720312f5.js"><link rel="prefetch" href="/assets/js/21.ded98e0f.js"><link rel="prefetch" href="/assets/js/22.97f73749.js"><link rel="prefetch" href="/assets/js/23.9a078f42.js"><link rel="prefetch" href="/assets/js/24.d38e4a7a.js"><link rel="prefetch" href="/assets/js/25.05f0e142.js"><link rel="prefetch" href="/assets/js/26.1d8e8af3.js"><link rel="prefetch" href="/assets/js/28.f364071e.js"><link rel="prefetch" href="/assets/js/29.b3f6ef75.js"><link rel="prefetch" href="/assets/js/30.a46f11bd.js"><link rel="prefetch" href="/assets/js/31.1b13d8d1.js"><link rel="prefetch" href="/assets/js/32.0af6dfcd.js"><link rel="prefetch" href="/assets/js/33.0bb78317.js"><link rel="prefetch" href="/assets/js/34.4f33c285.js"><link rel="prefetch" href="/assets/js/35.ed290680.js"><link rel="prefetch" href="/assets/js/36.e87c137b.js"><link rel="prefetch" href="/assets/js/37.45c2681e.js"><link rel="prefetch" href="/assets/js/38.d2dcc99c.js"><link rel="prefetch" href="/assets/js/39.7dd9ae0a.js"><link rel="prefetch" href="/assets/js/4.8d4a860c.js"><link rel="prefetch" href="/assets/js/40.1abb1d21.js"><link rel="prefetch" href="/assets/js/41.dafc1c82.js"><link rel="prefetch" href="/assets/js/42.00a79892.js"><link rel="prefetch" href="/assets/js/43.d824c00e.js"><link rel="prefetch" href="/assets/js/44.7cd4304b.js"><link rel="prefetch" href="/assets/js/45.d10d790b.js"><link rel="prefetch" href="/assets/js/46.e4305394.js"><link rel="prefetch" href="/assets/js/47.491226dc.js"><link rel="prefetch" href="/assets/js/48.7f4b002c.js"><link rel="prefetch" href="/assets/js/49.e4d80963.js"><link rel="prefetch" href="/assets/js/50.f110a67a.js"><link rel="prefetch" href="/assets/js/51.86c9f8c9.js"><link rel="prefetch" href="/assets/js/52.c18ddf9e.js"><link rel="prefetch" href="/assets/js/53.e368a98b.js"><link rel="prefetch" href="/assets/js/54.2a88f804.js"><link rel="prefetch" href="/assets/js/55.98e1c50f.js"><link rel="prefetch" href="/assets/js/56.f6871679.js"><link rel="prefetch" href="/assets/js/57.399d1ca3.js"><link rel="prefetch" href="/assets/js/58.9950ba6e.js"><link rel="prefetch" href="/assets/js/59.dde38f82.js"><link rel="prefetch" href="/assets/js/6.dc286500.js"><link rel="prefetch" href="/assets/js/60.0561d845.js"><link rel="prefetch" href="/assets/js/61.e5ff37d9.js"><link rel="prefetch" href="/assets/js/62.d8345631.js"><link rel="prefetch" href="/assets/js/63.88af5898.js"><link rel="prefetch" href="/assets/js/64.9d152829.js"><link rel="prefetch" href="/assets/js/65.0b3c68b5.js"><link rel="prefetch" href="/assets/js/66.d9cb03c1.js"><link rel="prefetch" href="/assets/js/67.4e7defde.js"><link rel="prefetch" href="/assets/js/68.9639661b.js"><link rel="prefetch" href="/assets/js/69.a8995f74.js"><link rel="prefetch" href="/assets/js/7.ad32fd31.js"><link rel="prefetch" href="/assets/js/70.3abf2bb4.js"><link rel="prefetch" href="/assets/js/71.061c6832.js"><link rel="prefetch" href="/assets/js/72.0da682bc.js"><link rel="prefetch" href="/assets/js/73.9fa65361.js"><link rel="prefetch" href="/assets/js/74.c3c02692.js"><link rel="prefetch" href="/assets/js/75.a14d0dea.js"><link rel="prefetch" href="/assets/js/76.a0906d46.js"><link rel="prefetch" href="/assets/js/77.0e2e1410.js"><link rel="prefetch" href="/assets/js/78.514139cb.js"><link rel="prefetch" href="/assets/js/79.af2fc428.js"><link rel="prefetch" href="/assets/js/8.3532e2cd.js"><link rel="prefetch" href="/assets/js/9.55aa1538.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.a1e8bc2b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ecc20c62.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">本地煮鸡:8080</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><span class="title">笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="笔记" class="mobile-dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/hello-world/" class="nav-link">
  杂谈
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="施工中笔记" class="dropdown-title"><span class="title">施工中笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="施工中笔记" class="mobile-dropdown-title"><span class="title">施工中笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          编程语言
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/kotlin/" class="nav-link">
  Kotlin
</a></li><li class="dropdown-subitem"><a href="/python/" class="nav-link">
  Python
</a></li></ul></li><li class="dropdown-item"><h4>
          后端开发技术
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/" class="nav-link">
  Web
</a></li><li class="dropdown-subitem"><a href="/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/redis/" class="nav-link">
  Redis
</a></li></ul></li><li class="dropdown-item"><h4>
          学科基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/software-engineering/" class="nav-link">
  软件工程
</a></li><li class="dropdown-subitem"><a href="/algorithm/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          机器学习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/artificial-intelligence/" class="nav-link">
  人工智能
</a></li><li class="dropdown-subitem"><a href="/deep-learning/" class="nav-link">
  深度学习
</a></li><li class="dropdown-subitem"><a href="/recommender-systems/" class="nav-link">
  推荐系统
</a></li><li class="dropdown-subitem"><a href="/quantitative-methods-for-DA-AI/" class="nav-link">
  数据分析与人工智能定量分析
</a></li></ul></li><li class="dropdown-item"><h4>
          大数据
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hadoop/" class="nav-link">
  Hadoop
</a></li></ul></li><li class="dropdown-item"><h4>
          Android
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/" class="nav-link router-link-active">
  Framework
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://www.github.com/ZweiRm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/zweirm/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div> <a href="https://github.com/ZweiRm/localhost-8080.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记" class="dropdown-title"><span class="title">笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="笔记" class="mobile-dropdown-title"><span class="title">笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/hello-world/" class="nav-link">
  杂谈
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="施工中笔记" class="dropdown-title"><span class="title">施工中笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="施工中笔记" class="mobile-dropdown-title"><span class="title">施工中笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          编程语言
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/kotlin/" class="nav-link">
  Kotlin
</a></li><li class="dropdown-subitem"><a href="/python/" class="nav-link">
  Python
</a></li></ul></li><li class="dropdown-item"><h4>
          后端开发技术
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/" class="nav-link">
  Web
</a></li><li class="dropdown-subitem"><a href="/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/redis/" class="nav-link">
  Redis
</a></li></ul></li><li class="dropdown-item"><h4>
          学科基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/software-engineering/" class="nav-link">
  软件工程
</a></li><li class="dropdown-subitem"><a href="/algorithm/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          机器学习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/artificial-intelligence/" class="nav-link">
  人工智能
</a></li><li class="dropdown-subitem"><a href="/deep-learning/" class="nav-link">
  深度学习
</a></li><li class="dropdown-subitem"><a href="/recommender-systems/" class="nav-link">
  推荐系统
</a></li><li class="dropdown-subitem"><a href="/quantitative-methods-for-DA-AI/" class="nav-link">
  数据分析与人工智能定量分析
</a></li></ul></li><li class="dropdown-item"><h4>
          大数据
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hadoop/" class="nav-link">
  Hadoop
</a></li></ul></li><li class="dropdown-item"><h4>
          Android
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/framework/" class="nav-link router-link-active">
  Framework
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://www.github.com/ZweiRm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/zweirm/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div> <a href="https://github.com/ZweiRm/localhost-8080.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/framework/" aria-current="page" class="sidebar-link">Framework</a></li><li><a href="/framework/activity-launching-process.html" class="sidebar-link">Activity 启动流程</a></li><li><a href="/framework/performTraversal.html" aria-current="page" class="active sidebar-link">ViewRootImpl 中 performTraversal() 梳理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/framework/performTraversal.html#源码" class="sidebar-link">源码</a></li><li class="sidebar-sub-header"><a href="/framework/performTraversal.html#参考文献或资料" class="sidebar-link">参考文献或资料</a></li></ul></li><li><a href="/framework/container.html" class="sidebar-link">Android 12 容器层级</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="viewrootimpl-中-performtraversal-梳理"><a href="#viewrootimpl-中-performtraversal-梳理" class="header-anchor">#</a> ViewRootImpl 中 performTraversal() 梳理</h1> <h2 id="源码"><a href="#源码" class="header-anchor">#</a> 源码</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 描述 Activity 窗口属性的成员变量</span>
<span class="token keyword">final</span> <span class="token class-name">View<span class="token punctuation">.</span>AttachInfo</span> mAttachInfo<span class="token punctuation">;</span>

<span class="token comment">// 描述 Activity 窗口当前大小，由上一次请求 WMS 计算得到</span>
<span class="token keyword">int</span> mWidth<span class="token punctuation">;</span>
<span class="token keyword">int</span> mHeight<span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">performTraversals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// cache mView since it is used so much below...</span>
    <span class="token comment">// 顶层窗口 host，引用 ViewRootImpl 类成员变量 mView</span>
    <span class="token keyword">final</span> <span class="token class-name">View</span> host <span class="token operator">=</span> mView<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>DBG<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;======================================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;performTraversals&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        host<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>host <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>mAdded<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// This is to ensure we don't end up queueing new frames while waiting on a previous frame</span>
    <span class="token comment">// to get latched. This can happen when there's been a sync request for this window. The</span>
    <span class="token comment">// frame could be in a transaction that's passed to different processes to ensure</span>
    <span class="token comment">// synchronization. It continues to block until ViewRootImpl receives a callback that the</span>
    <span class="token comment">// transaction containing the buffer has been sent to SurfaceFlinger. Once we receive, that</span>
    <span class="token comment">// signal, we know it's safe to start queuing new buffers.</span>
    <span class="token comment">//</span>
    <span class="token comment">// When the callback is invoked, it will trigger a traversal request if</span>
    <span class="token comment">// mRequestedTraverseWhilePaused is set so there's no need to attempt a retry here.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mWaitForBlastSyncComplete<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG_BLAST<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>mTag<span class="token punctuation">,</span> <span class="token string">&quot;Can't perform draw while waiting for a transaction complete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        mRequestedTraverseWhilePaused <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    mIsInTraversal <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    mWillDrawSoon <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> windowSizeMayChange <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span> lp <span class="token operator">=</span> mWindowAttributes<span class="token punctuation">;</span>

    <span class="token comment">// 存放当前 Activity 窗口大小</span>
    <span class="token keyword">int</span> desiredWindowWidth<span class="token punctuation">;</span>
    <span class="token keyword">int</span> desiredWindowHeight<span class="token punctuation">;</span>

    <span class="token keyword">final</span> <span class="token keyword">int</span> viewVisibility <span class="token operator">=</span> <span class="token function">getHostVisibility</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> viewVisibilityChanged <span class="token operator">=</span> <span class="token operator">!</span>mFirst
            <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>mViewVisibility <span class="token operator">!=</span> viewVisibility <span class="token operator">||</span> mNewSurfaceNeeded
            <span class="token comment">// Also check for possible double visibility update, which will make current</span>
            <span class="token comment">// viewVisibility value equal to mViewVisibility and we may miss it.</span>
            <span class="token operator">||</span> mAppVisibilityChanged<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mAppVisibilityChanged <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> viewUserVisibilityChanged <span class="token operator">=</span> <span class="token operator">!</span>mFirst <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>mViewVisibility <span class="token operator">==</span> <span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>viewVisibility <span class="token operator">==</span> <span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span> params <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">CompatibilityInfo</span> compatibilityInfo <span class="token operator">=</span>
            mDisplay<span class="token punctuation">.</span><span class="token function">getDisplayAdjustments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCompatibilityInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>compatibilityInfo<span class="token punctuation">.</span><span class="token function">supportsScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> mLastInCompatMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        params <span class="token operator">=</span> lp<span class="token punctuation">;</span>
        mFullRedrawNeeded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        mLayoutRequested <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mLastInCompatMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            params<span class="token punctuation">.</span>privateFlags <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>PRIVATE_FLAG_COMPATIBLE_WINDOW<span class="token punctuation">;</span>
            mLastInCompatMode <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            params<span class="token punctuation">.</span>privateFlags <span class="token operator">|=</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>PRIVATE_FLAG_COMPATIBLE_WINDOW<span class="token punctuation">;</span>
            mLastInCompatMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 计算期望窗口大小</span>
    <span class="token comment">// 引用 ViewRoolImpl 类成员变量 mWinFrame，保存当前 Activity 大小</span>
    <span class="token comment">// 数据请求经请求 WMS 计算后得到</span>
    <span class="token class-name">Rect</span> frame <span class="token operator">=</span> mWinFrame<span class="token punctuation">;</span>
    <span class="token comment">// 第一次被请求执行测量、布局和绘制操作，当前大小等于屏幕大小</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mFirst<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 标记需要重新布局和绘制</span>
        mFullRedrawNeeded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        mLayoutRequested <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token class-name">Configuration</span> config <span class="token operator">=</span> <span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 初始化期望窗口长宽</span>
        <span class="token comment">// 根据 layoutPrams 的 type （是否有状态栏） 判断是否需要使用屏幕全尺寸</span>
        <span class="token comment">// 需要则使用屏幕真实尺寸，不去除任何装饰尺寸</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldUseDisplaySize</span><span class="token punctuation">(</span>lp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// NOTE -- system code, won't try to do compat mode.</span>
            <span class="token class-name">Point</span> size <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mDisplay<span class="token punctuation">.</span><span class="token function">getRealSize</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            desiredWindowWidth <span class="token operator">=</span> size<span class="token punctuation">.</span>x<span class="token punctuation">;</span>    <span class="token comment">// 包含状态栏</span>
            desiredWindowHeight <span class="token operator">=</span> size<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        <span class="token comment">// 否则让窗口大小为最大可用尺寸（当 Activity 使用 WarpContent）</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>lp<span class="token punctuation">.</span>width <span class="token operator">==</span> <span class="token class-name">ViewGroup<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>WRAP_CONTENT
                <span class="token operator">||</span> lp<span class="token punctuation">.</span>height <span class="token operator">==</span> <span class="token class-name">ViewGroup<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>WRAP_CONTENT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 对于包装内容，我们无论如何都要在以后重新测量。</span>
            <span class="token comment">// 使用与下面一致的尺寸，以便我们能够最好地利用测量缓存。</span>
            desiredWindowWidth <span class="token operator">=</span> <span class="token function">dipToPx</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>screenWidthDp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 不包含状态栏</span>
            desiredWindowHeight <span class="token operator">=</span> <span class="token function">dipToPx</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>screenHeightDp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// After addToDisplay, the frame contains the frameHint from window manager, which</span>
            <span class="token comment">// for most windows is going to be the same size as the result of relayoutWindow.</span>
            <span class="token comment">// Using this here allows us to avoid remeasuring after relayoutWindow</span>
            desiredWindowWidth <span class="token operator">=</span> frame<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            desiredWindowHeight <span class="token operator">=</span> frame<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// We used to use the following condition to choose 32 bits drawing caches:</span>
        <span class="token comment">// PixelFormat.hasAlpha(lp.format) || lp.format == PixelFormat.RGBX_8888</span>
        <span class="token comment">// However, windows are now always 32 bits by default, so choose 32 bits</span>
        mAttachInfo<span class="token punctuation">.</span>mUse32BitDrawingCache <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        mAttachInfo<span class="token punctuation">.</span>mWindowVisibility <span class="token operator">=</span> viewVisibility<span class="token punctuation">;</span>
        mAttachInfo<span class="token punctuation">.</span>mRecomputeGlobalAttributes <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        mLastConfigurationFromResources<span class="token punctuation">.</span><span class="token function">setTo</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mLastSystemUiVisibility <span class="token operator">=</span> mAttachInfo<span class="token punctuation">.</span>mSystemUiVisibility<span class="token punctuation">;</span>
        <span class="token comment">// Set the layout direction if it has not been set before (inherit is the default)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mViewLayoutDirectionInitial <span class="token operator">==</span> <span class="token class-name">View</span><span class="token punctuation">.</span>LAYOUT_DIRECTION_INHERIT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            host<span class="token punctuation">.</span><span class="token function">setLayoutDirection</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getLayoutDirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        host<span class="token punctuation">.</span><span class="token function">dispatchAttachedToWindow</span><span class="token punctuation">(</span>mAttachInfo<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mAttachInfo<span class="token punctuation">.</span>mTreeObserver<span class="token punctuation">.</span><span class="token function">dispatchOnWindowAttachedChange</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dispatchApplyInsets</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 非第一次请求，屏幕大小为 mWinFrame 中存储的大小 </span>
    <span class="token comment">//（数据来自于上一次主动请求 WMS 计算）</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        desiredWindowWidth <span class="token operator">=</span> frame<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        desiredWindowHeight <span class="token operator">=</span> frame<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Activity 当前大小不等于上次主动请求计算的大小</span>
        <span class="token comment">// 标记需要重新绘制和布局</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>desiredWindowWidth <span class="token operator">!=</span> mWidth <span class="token operator">||</span> desiredWindowHeight <span class="token operator">!=</span> mHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG_ORIENTATION<span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span>mTag<span class="token punctuation">,</span> <span class="token string">&quot;View &quot;</span> <span class="token operator">+</span> host <span class="token operator">+</span> <span class="token string">&quot; resized to: &quot;</span> <span class="token operator">+</span> frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mFullRedrawNeeded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            mLayoutRequested <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            windowSizeMayChange <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token comment">// 标记 Activity 窗口大小发生变化</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>viewVisibilityChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mAttachInfo<span class="token punctuation">.</span>mWindowVisibility <span class="token operator">=</span> viewVisibility<span class="token punctuation">;</span>
        host<span class="token punctuation">.</span><span class="token function">dispatchWindowVisibilityChanged</span><span class="token punctuation">(</span>viewVisibility<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>viewUserVisibilityChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            host<span class="token punctuation">.</span><span class="token function">dispatchVisibilityAggregated</span><span class="token punctuation">(</span>viewVisibility <span class="token operator">==</span> <span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>viewVisibility <span class="token operator">!=</span> <span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE <span class="token operator">||</span> mNewSurfaceNeeded<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">endDragResizing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">destroyHardwareResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Non-visible windows can't hold accessibility focus.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mAttachInfo<span class="token punctuation">.</span>mWindowVisibility <span class="token operator">!=</span> <span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        host<span class="token punctuation">.</span><span class="token function">clearAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Execute enqueued actions on every traversal in case a detached view enqueued an action</span>
    <span class="token function">getRunQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">executeActions</span><span class="token punctuation">(</span>mAttachInfo<span class="token punctuation">.</span>mHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 在 Activity 主动请求计算前对顶层视图 host 进行测量</span>
    <span class="token keyword">boolean</span> cutoutChanged <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取重新布局标记</span>
    <span class="token keyword">boolean</span> layoutRequested <span class="token operator">=</span> mLayoutRequested <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>mStopped <span class="token operator">||</span> mReportNextDraw<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 当需要重新布局时</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>layoutRequested<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">Resources</span> res <span class="token operator">=</span> mView<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Activity 第一次被请求</span>
        <span class="token comment">// 在 Activity 四周留下足够的空间来放置状态栏和输入法</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mFirst<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 通过将缓存值设置为与添加的触摸模式相反，确保触摸模式代码的执行。</span>
            <span class="token comment">// 确保 window 的触摸模式已经打开</span>
            mAttachInfo<span class="token punctuation">.</span>mInTouchMode <span class="token operator">=</span> <span class="token operator">!</span>mAddedTouchMode<span class="token punctuation">;</span>
            <span class="token function">ensureTouchModeLocally</span><span class="token punctuation">(</span>mAddedTouchMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 非第一次请求</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 若 Activity 宽高被设置成了 WarpContent，则窗口大小等于内容大小</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lp<span class="token punctuation">.</span>width <span class="token operator">==</span> <span class="token class-name">ViewGroup<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>WRAP_CONTENT
                    <span class="token operator">||</span> lp<span class="token punctuation">.</span>height <span class="token operator">==</span> <span class="token class-name">ViewGroup<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>WRAP_CONTENT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                windowSizeMayChange <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token comment">// 标记 Activity 窗口大小发生变化</span>

                <span class="token comment">// 设置 WarpContent 时当前大小与屏幕大小相同</span>
                <span class="token comment">// 根据 layoutPrams 的 type （是否有状态栏） 判断是否需要使用屏幕全尺寸</span>
                <span class="token comment">// 需要则使用屏幕真实尺寸，不去除任何装饰尺寸</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldUseDisplaySize</span><span class="token punctuation">(</span>lp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// NOTE -- system code, won't try to do compat mode.</span>
                    <span class="token class-name">Point</span> size <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mDisplay<span class="token punctuation">.</span><span class="token function">getRealSize</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    desiredWindowWidth <span class="token operator">=</span> size<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
                    desiredWindowHeight <span class="token operator">=</span> size<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
                <span class="token comment">// 否则让窗口大小为最大可用尺寸</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Configuration</span> config <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    desiredWindowWidth <span class="token operator">=</span> <span class="token function">dipToPx</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>screenWidthDp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    desiredWindowHeight <span class="token operator">=</span> <span class="token function">dipToPx</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>screenHeightDp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 计算顶层视图 host 大小</span>
        <span class="token comment">// 期间调用 performMeasure() 确定窗口大小，返回窗口大小是否会改变</span>
        <span class="token comment">// 是测量流程的入口</span>
        <span class="token comment">// Ask host how big it wants to be</span>
        windowSizeMayChange <span class="token operator">|=</span> <span class="token function">measureHierarchy</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> lp<span class="token punctuation">,</span> res<span class="token punctuation">,</span>
                desiredWindowWidth<span class="token punctuation">,</span> desiredWindowHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">collectViewAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        params <span class="token operator">=</span> lp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mAttachInfo<span class="token punctuation">.</span>mForceReportNewAttributes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mAttachInfo<span class="token punctuation">.</span>mForceReportNewAttributes <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        params <span class="token operator">=</span> lp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>mFirst <span class="token operator">||</span> mAttachInfo<span class="token punctuation">.</span>mViewVisibilityChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mAttachInfo<span class="token punctuation">.</span>mViewVisibilityChanged <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> resizeMode <span class="token operator">=</span> mSoftInputMode <span class="token operator">&amp;</span> SOFT_INPUT_MASK_ADJUST<span class="token punctuation">;</span>
        <span class="token comment">// If we are in auto resize mode, then we need to determine</span>
        <span class="token comment">// what mode to use now.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>resizeMode <span class="token operator">==</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>SOFT_INPUT_ADJUST_UNSPECIFIED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">N</span> <span class="token operator">=</span> mAttachInfo<span class="token punctuation">.</span>mScrollContainers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token class-name">N</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mAttachInfo<span class="token punctuation">.</span>mScrollContainers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isShown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    resizeMode <span class="token operator">=</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>SOFT_INPUT_ADJUST_RESIZE<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>resizeMode <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                resizeMode <span class="token operator">=</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>SOFT_INPUT_ADJUST_PAN<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>lp<span class="token punctuation">.</span>softInputMode <span class="token operator">&amp;</span> SOFT_INPUT_MASK_ADJUST<span class="token punctuation">)</span> <span class="token operator">!=</span> resizeMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                lp<span class="token punctuation">.</span>softInputMode <span class="token operator">=</span> <span class="token punctuation">(</span>lp<span class="token punctuation">.</span>softInputMode <span class="token operator">&amp;</span> <span class="token operator">~</span>SOFT_INPUT_MASK_ADJUST<span class="token punctuation">)</span> <span class="token operator">|</span> resizeMode<span class="token punctuation">;</span>
                params <span class="token operator">=</span> lp<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>mApplyInsetsRequested <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>mWillMove <span class="token operator">||</span> mWillResize<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">dispatchApplyInsets</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mLayoutRequested<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Short-circuit catching a new layout request here, so</span>
            <span class="token comment">// we don't need to go through two layout passes when things</span>
            <span class="token comment">// change due to fitting system windows, which can happen a lot.</span>
            windowSizeMayChange <span class="token operator">|=</span> <span class="token function">measureHierarchy</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> lp<span class="token punctuation">,</span>
                    mView<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    desiredWindowWidth<span class="token punctuation">,</span> desiredWindowHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 暂时清空需要重布局的标记，等需要时再重新赋值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>layoutRequested<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Clear this now, so that if anything requests a layout in the</span>
        <span class="token comment">// rest of this function we will catch it and re-run a full</span>
        <span class="token comment">// layout pass.</span>
        mLayoutRequested <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 检查 Activity 大小是否变化，若满足条件就需要将其设置为 true</span>
    <span class="token keyword">boolean</span> windowShouldResize <span class="token operator">=</span> 
        <span class="token comment">// Activity 发起新的重布局</span>
        layoutRequested 
        <span class="token comment">// 前面步骤已检测到 Activity 窗口发生变化</span>
        <span class="token operator">&amp;&amp;</span> windowSizeMayChange
        <span class="token comment">// 并且</span>
        <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
            <span class="token comment">// 上面流程测得的顶层视图 host 大小与当前 Activity 大小不一致</span>
            <span class="token punctuation">(</span>mWidth <span class="token operator">!=</span> host<span class="token punctuation">.</span><span class="token function">getMeasuredWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> mHeight <span class="token operator">!=</span> host<span class="token punctuation">.</span><span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// Activity 设置为 WarpContent</span>
            <span class="token comment">// 且 WMS 计算得到的当前大小 小于 当前大小</span>
            <span class="token comment">// 且 WMS 计算得到的当前大小 不等于 上一次计算大小</span>
            <span class="token operator">||</span> <span class="token punctuation">(</span>lp<span class="token punctuation">.</span>width <span class="token operator">==</span> <span class="token class-name">ViewGroup<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>WRAP_CONTENT <span class="token operator">&amp;&amp;</span>
                    frame<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> desiredWindowWidth <span class="token operator">&amp;&amp;</span> frame<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> mWidth<span class="token punctuation">)</span>
            <span class="token operator">||</span> <span class="token punctuation">(</span>lp<span class="token punctuation">.</span>height <span class="token operator">==</span> <span class="token class-name">ViewGroup<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>WRAP_CONTENT <span class="token operator">&amp;&amp;</span>
                    frame<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> desiredWindowHeight <span class="token operator">&amp;&amp;</span> frame<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> mHeight<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    windowShouldResize <span class="token operator">|=</span> mDragResizing <span class="token operator">&amp;&amp;</span> mResizeMode <span class="token operator">==</span> RESIZE_MODE_FREEFORM<span class="token punctuation">;</span>

    <span class="token comment">// If the activity was just relaunched, it might have unfrozen the task bounds (while</span>
    <span class="token comment">// relaunching), so we need to force a call into window manager to pick up the latest</span>
    <span class="token comment">// bounds.</span>
    <span class="token comment">// Activity 重启</span>
    windowShouldResize <span class="token operator">|=</span> mActivityRelaunched<span class="token punctuation">;</span>

    <span class="token comment">// 检查 Activity 是否需要重新计算边衬</span>
    <span class="token comment">// 当设置了监听或者存在需要重新设置的空边衬时需要</span>
    <span class="token comment">// 确定是否要计算边衬。</span>
    <span class="token comment">// 如果没有剩余的边衬监听器，那么我们可能仍然需要计算边衬</span>
    <span class="token comment">// 以防旧的边衬是非空的且必须被重置。</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> computesInternalInsets <span class="token operator">=</span>
            mAttachInfo<span class="token punctuation">.</span>mTreeObserver<span class="token punctuation">.</span><span class="token function">hasComputeInternalInsetsListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">||</span> mAttachInfo<span class="token punctuation">.</span>mHasNonEmptyGivenInternalInsets<span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> insetsPending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> relayoutResult <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> updatedConfiguration <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">final</span> <span class="token keyword">int</span> surfaceGenerationId <span class="token operator">=</span> mSurface<span class="token punctuation">.</span><span class="token function">getGenerationId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">final</span> <span class="token keyword">boolean</span> isViewVisible <span class="token operator">=</span> viewVisibility <span class="token operator">==</span> <span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> windowRelayoutWasForced <span class="token operator">=</span> mForceNextWindowRelayout<span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> surfaceSizeChanged <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> surfaceCreated <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> surfaceDestroyed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// True if surface generation id changes or relayout result is RELAYOUT_RES_SURFACE_CHANGED.</span>
    <span class="token keyword">boolean</span> surfaceReplaced <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">final</span> <span class="token keyword">boolean</span> windowAttributesChanged <span class="token operator">=</span> mWindowAttributesChanged<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>windowAttributesChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mWindowAttributesChanged <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        params <span class="token operator">=</span> lp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>params <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">.</span>mPrivateFlags <span class="token operator">&amp;</span> <span class="token class-name">View</span><span class="token punctuation">.</span>PFLAG_REQUEST_TRANSPARENT_REGIONS<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span>
                <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">PixelFormat</span><span class="token punctuation">.</span><span class="token function">formatHasAlpha</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>format<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            params<span class="token punctuation">.</span>format <span class="token operator">=</span> <span class="token class-name">PixelFormat</span><span class="token punctuation">.</span>TRANSLUCENT<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">adjustLayoutParamsForCompatibility</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">controlInsetsForCompatibility</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mDispatchedSystemBarAppearance <span class="token operator">!=</span> params<span class="token punctuation">.</span>insetsFlags<span class="token punctuation">.</span>appearance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mDispatchedSystemBarAppearance <span class="token operator">=</span> params<span class="token punctuation">.</span>insetsFlags<span class="token punctuation">.</span>appearance<span class="token punctuation">;</span>
            mView<span class="token punctuation">.</span><span class="token function">onSystemBarAppearanceChanged</span><span class="token punctuation">(</span>mDispatchedSystemBarAppearance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> wasReportNextDraw <span class="token operator">=</span> mReportNextDraw<span class="token punctuation">;</span>

    <span class="token comment">// 确定窗口尺寸，调用 WMS 计算并保存</span>
    <span class="token comment">// 若 Activity 第一次被请求测量布局和绘制</span>
    <span class="token comment">// 或 Activity 创建大小发生变化</span>
    <span class="token comment">// 或 Activity 可见性发生变化</span>
    <span class="token comment">// 或 Activity 窗口属性发生变化（指向 WindowManager.LayoutParams 对象）</span>
    <span class="token comment">// 或 强制下一个窗口重新布局</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mFirst <span class="token operator">||</span> windowShouldResize <span class="token operator">||</span> viewVisibilityChanged <span class="token operator">||</span> params <span class="token operator">!=</span> <span class="token keyword">null</span>
            <span class="token operator">||</span> mForceNextWindowRelayout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mForceNextWindowRelayout <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token comment">// 如果这个窗口给窗口管理器提供了内部边衬，那么我们要首先</span>
        <span class="token comment">// 在布局过程中使提供的边衬不发生变化。这可以避免它</span>
        <span class="token comment">// 短暂地导致其他窗口根据窗口的原始框架调整大小/移动，等到我们</span>
        <span class="token comment">// 可以完成这个窗口的布局，并将最终计算出的边衬返回给窗口管理器。</span>
        <span class="token comment">// 表示 Activity 窗口由额外的内容边衬和可见边衬等待指定</span>
        <span class="token comment">// 边衬发生改变</span>
        insetsPending <span class="token operator">=</span> computesInternalInsets<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mSurfaceHolder <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mSurfaceHolder<span class="token punctuation">.</span>mSurfaceLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mDrawingAllowed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">boolean</span> hwInitialized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> dispatchApplyInsets <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> hadSurface <span class="token operator">=</span> mSurface<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 调用 WMS 重新计算并保存</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG_LAYOUT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span>mTag<span class="token punctuation">,</span> <span class="token string">&quot;host=w:&quot;</span> <span class="token operator">+</span> host<span class="token punctuation">.</span><span class="token function">getMeasuredWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, h:&quot;</span> <span class="token operator">+</span>
                        host<span class="token punctuation">.</span><span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, params=&quot;</span> <span class="token operator">+</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mAttachInfo<span class="token punctuation">.</span>mThreadedRenderer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// relayoutWindow may decide to destroy mSurface. As that decision</span>
                <span class="token comment">// happens in WindowManager service, we need to be defensive here</span>
                <span class="token comment">// and stop using the surface in case it gets destroyed.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mAttachInfo<span class="token punctuation">.</span>mThreadedRenderer<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// Animations were running so we need to push a frame</span>
                    <span class="token comment">// to resume them</span>
                    mDirty<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mWidth<span class="token punctuation">,</span> mHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mFirst <span class="token operator">||</span> viewVisibilityChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mViewFrameInfo<span class="token punctuation">.</span>flags <span class="token operator">|=</span> <span class="token class-name">FrameInfo</span><span class="token punctuation">.</span>FLAG_WINDOW_VISIBILITY_CHANGED<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 请求 WMS 计算 Activity 大小及内容边衬和可见边衬大小</span>
            <span class="token comment">// 通过 IPC 请求 WMS</span>
            <span class="token comment">// 结果会被保存在 mWinFrame 中</span>
            relayoutResult <span class="token operator">=</span> <span class="token function">relayoutWindow</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> viewVisibility<span class="token punctuation">,</span> insetsPending<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token keyword">boolean</span> freeformResizing <span class="token operator">=</span> <span class="token punctuation">(</span>relayoutResult
                    <span class="token operator">&amp;</span> <span class="token class-name">WindowManagerGlobal</span><span class="token punctuation">.</span>RELAYOUT_RES_DRAG_RESIZING_FREEFORM<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token keyword">boolean</span> dockedResizing <span class="token operator">=</span> <span class="token punctuation">(</span>relayoutResult
                    <span class="token operator">&amp;</span> <span class="token class-name">WindowManagerGlobal</span><span class="token punctuation">.</span>RELAYOUT_RES_DRAG_RESIZING_DOCKED<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token keyword">boolean</span> dragResizing <span class="token operator">=</span> freeformResizing <span class="token operator">||</span> dockedResizing<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>relayoutResult <span class="token operator">&amp;</span> <span class="token class-name">WindowManagerGlobal</span><span class="token punctuation">.</span>RELAYOUT_RES_BLAST_SYNC<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG_BLAST<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>mTag<span class="token punctuation">,</span> <span class="token string">&quot;Relayout called with blastSync&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">reportNextDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isHardwareEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mNextDrawUseBlastSync <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>mSurfaceControl<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">updateOpacity</span><span class="token punctuation">(</span>mWindowAttributes<span class="token punctuation">,</span> dragResizing<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG_LAYOUT<span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span>mTag<span class="token punctuation">,</span> <span class="token string">&quot;relayout: frame=&quot;</span> <span class="token operator">+</span> frame<span class="token punctuation">.</span><span class="token function">toShortString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token operator">+</span> <span class="token string">&quot; surface=&quot;</span> <span class="token operator">+</span> mSurface<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// If the pending {@link MergedConfiguration} handed back from</span>
            <span class="token comment">// {@link #relayoutWindow} does not match the one last reported,</span>
            <span class="token comment">// WindowManagerService has reported back a frame from a configuration not yet</span>
            <span class="token comment">// handled by the client. In this case, we need to accept the configuration so we</span>
            <span class="token comment">// do not lay out and draw with the wrong configuration.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mPendingMergedConfiguration<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mLastReportedMergedConfiguration<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG_CONFIGURATION<span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span>mTag<span class="token punctuation">,</span> <span class="token string">&quot;Visible with new config: &quot;</span>
                        <span class="token operator">+</span> mPendingMergedConfiguration<span class="token punctuation">.</span><span class="token function">getMergedConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">performConfigurationChange</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MergedConfiguration</span><span class="token punctuation">(</span>mPendingMergedConfiguration<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token operator">!</span>mFirst<span class="token punctuation">,</span> INVALID_DISPLAY <span class="token comment">/* same display */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                updatedConfiguration <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            surfaceSizeChanged <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mLastSurfaceSize<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mSurfaceSize<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                surfaceSizeChanged <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                mLastSurfaceSize<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>mSurfaceSize<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mSurfaceSize<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">final</span> <span class="token keyword">boolean</span> alwaysConsumeSystemBarsChanged <span class="token operator">=</span>
                    mPendingAlwaysConsumeSystemBars <span class="token operator">!=</span> mAttachInfo<span class="token punctuation">.</span>mAlwaysConsumeSystemBars<span class="token punctuation">;</span>
            <span class="token function">updateColorModeIfNeeded</span><span class="token punctuation">(</span>lp<span class="token punctuation">.</span><span class="token function">getColorMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            surfaceCreated <span class="token operator">=</span> <span class="token operator">!</span>hadSurface <span class="token operator">&amp;&amp;</span> mSurface<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            surfaceDestroyed <span class="token operator">=</span> hadSurface <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mSurface<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// When using Blast, the surface generation id may not change when there's a new</span>
            <span class="token comment">// SurfaceControl. In that case, we also check relayout flag</span>
            <span class="token comment">// RELAYOUT_RES_SURFACE_CHANGED since it should indicate that WMS created a new</span>
            <span class="token comment">// SurfaceControl.</span>
            surfaceReplaced <span class="token operator">=</span> <span class="token punctuation">(</span>surfaceGenerationId <span class="token operator">!=</span> mSurface<span class="token punctuation">.</span><span class="token function">getGenerationId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token operator">||</span> <span class="token punctuation">(</span>relayoutResult <span class="token operator">&amp;</span> RELAYOUT_RES_SURFACE_CHANGED<span class="token punctuation">)</span>
                    <span class="token operator">==</span> RELAYOUT_RES_SURFACE_CHANGED<span class="token punctuation">)</span>
                    <span class="token operator">&amp;&amp;</span> mSurface<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>surfaceReplaced<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mSurfaceSequenceId<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>alwaysConsumeSystemBarsChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mAttachInfo<span class="token punctuation">.</span>mAlwaysConsumeSystemBars <span class="token operator">=</span> mPendingAlwaysConsumeSystemBars<span class="token punctuation">;</span>
                dispatchApplyInsets <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">updateCaptionInsets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                dispatchApplyInsets <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>dispatchApplyInsets <span class="token operator">||</span> mLastSystemUiVisibility <span class="token operator">!=</span>
                    mAttachInfo<span class="token punctuation">.</span>mSystemUiVisibility <span class="token operator">||</span> mApplyInsetsRequested<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mLastSystemUiVisibility <span class="token operator">=</span> mAttachInfo<span class="token punctuation">.</span>mSystemUiVisibility<span class="token punctuation">;</span>
                <span class="token function">dispatchApplyInsets</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// We applied insets so force contentInsetsChanged to ensure the</span>
                <span class="token comment">// hierarchy is measured below.</span>
                dispatchApplyInsets <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>surfaceCreated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// If we are creating a new surface, then we need to</span>
                <span class="token comment">// completely redraw it.</span>
                mFullRedrawNeeded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                mPreviousTransparentRegion<span class="token punctuation">.</span><span class="token function">setEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Only initialize up-front if transparent regions are not</span>
                <span class="token comment">// requested, otherwise defer to see if the entire window</span>
                <span class="token comment">// will be transparent</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mAttachInfo<span class="token punctuation">.</span>mThreadedRenderer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        hwInitialized <span class="token operator">=</span> mAttachInfo<span class="token punctuation">.</span>mThreadedRenderer<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>mSurface<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>hwInitialized <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>host<span class="token punctuation">.</span>mPrivateFlags
                                        <span class="token operator">&amp;</span> <span class="token class-name">View</span><span class="token punctuation">.</span>PFLAG_REQUEST_TRANSPARENT_REGIONS<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">// Don't pre-allocate if transparent regions</span>
                            <span class="token comment">// are requested as they may not be needed</span>
                            mAttachInfo<span class="token punctuation">.</span>mThreadedRenderer<span class="token punctuation">.</span><span class="token function">allocateBuffers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">OutOfResourcesException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">handleOutOfResourcesException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>surfaceDestroyed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// If the surface has been removed, then reset the scroll</span>
                <span class="token comment">// positions.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mLastScrolledFocus <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mLastScrolledFocus<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                mScrollY <span class="token operator">=</span> mCurScrollY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mView <span class="token keyword">instanceof</span> <span class="token class-name">RootViewSurfaceTaker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">RootViewSurfaceTaker</span><span class="token punctuation">)</span> mView<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onRootViewScrollYChanged</span><span class="token punctuation">(</span>mCurScrollY<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mScroller <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mScroller<span class="token punctuation">.</span><span class="token function">abortAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// Our surface is gone</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isHardwareEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mAttachInfo<span class="token punctuation">.</span>mThreadedRenderer<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>surfaceReplaced
                    <span class="token operator">||</span> surfaceSizeChanged <span class="token operator">||</span> windowRelayoutWasForced<span class="token punctuation">)</span>
                    <span class="token operator">&amp;&amp;</span> mSurfaceHolder <span class="token operator">==</span> <span class="token keyword">null</span>
                    <span class="token operator">&amp;&amp;</span> mAttachInfo<span class="token punctuation">.</span>mThreadedRenderer <span class="token operator">!=</span> <span class="token keyword">null</span>
                    <span class="token operator">&amp;&amp;</span> mSurface<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mFullRedrawNeeded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// Need to do updateSurface (which leads to CanvasContext::setSurface and</span>
                    <span class="token comment">// re-create the EGLSurface) if either the Surface changed (as indicated by</span>
                    <span class="token comment">// generation id), or WindowManager changed the surface size. The latter is</span>
                    <span class="token comment">// because on some chips, changing the consumer side's BufferQueue size may</span>
                    <span class="token comment">// not take effect immediately unless we create a new EGLSurface.</span>
                    <span class="token comment">// Note that frame size change doesn't always imply surface size change (eg.</span>
                    <span class="token comment">// drag resizing uses fullscreen surface), need to check surfaceSizeChanged</span>
                    <span class="token comment">// flag from WindowManager.</span>
                    mAttachInfo<span class="token punctuation">.</span>mThreadedRenderer<span class="token punctuation">.</span><span class="token function">updateSurface</span><span class="token punctuation">(</span>mSurface<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">OutOfResourcesException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">handleOutOfResourcesException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>mDragResizing <span class="token operator">!=</span> dragResizing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>dragResizing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mResizeMode <span class="token operator">=</span> freeformResizing
                            <span class="token operator">?</span> RESIZE_MODE_FREEFORM
                            <span class="token operator">:</span> RESIZE_MODE_DOCKED_DIVIDER<span class="token punctuation">;</span>
                    <span class="token keyword">final</span> <span class="token keyword">boolean</span> backdropSizeMatchesFrame <span class="token operator">=</span>
                            mWinFrame<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> mPendingBackDropFrame<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token operator">&amp;&amp;</span> mWinFrame<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> mPendingBackDropFrame<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// TODO: Need cutout?</span>
                    <span class="token function">startDragResizing</span><span class="token punctuation">(</span>mPendingBackDropFrame<span class="token punctuation">,</span> <span class="token operator">!</span>backdropSizeMatchesFrame<span class="token punctuation">,</span>
                            mAttachInfo<span class="token punctuation">.</span>mContentInsets<span class="token punctuation">,</span> mAttachInfo<span class="token punctuation">.</span>mStableInsets<span class="token punctuation">,</span> mResizeMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">// We shouldn't come here, but if we come we should end the resize.</span>
                    <span class="token function">endDragResizing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mUseMTRenderer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>dragResizing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mCanvasOffsetX <span class="token operator">=</span> mWinFrame<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
                    mCanvasOffsetY <span class="token operator">=</span> mWinFrame<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    mCanvasOffsetX <span class="token operator">=</span> mCanvasOffsetY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RemoteException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG_ORIENTATION<span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span>
                TAG<span class="token punctuation">,</span> <span class="token string">&quot;Relayout returned: frame=&quot;</span> <span class="token operator">+</span> frame <span class="token operator">+</span> <span class="token string">&quot;, surface=&quot;</span> <span class="token operator">+</span> mSurface<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Activity 请求 WMS 计算得到窗口左上坐标。保存在 mAttachInfo 的成员变量中</span>
        mAttachInfo<span class="token punctuation">.</span>mWindowLeft <span class="token operator">=</span> frame<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        mAttachInfo<span class="token punctuation">.</span>mWindowTop <span class="token operator">=</span> frame<span class="token punctuation">.</span>top<span class="token punctuation">;</span>

        <span class="token comment">// !!FIXME!! This next section handles the case where we did not get the</span>
        <span class="token comment">// window size we asked for. We should avoid this by getting a maximum size from</span>
        <span class="token comment">// the window session beforehand.</span>
        <span class="token comment">// Activity 请求 WMS 计算得到的窗口大小。保存在 mWidth 和 mHeight 中</span>
        <span class="token comment">// 若前一次计算结果和本次不同就重新赋值</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mWidth <span class="token operator">!=</span> frame<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> mHeight <span class="token operator">!=</span> frame<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mWidth <span class="token operator">=</span> frame<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mHeight <span class="token operator">=</span> frame<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mSurfaceHolder <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// The app owns the surface; tell it about what is going on.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mSurface<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// XXX .copyFrom() doesn't work!</span>
                <span class="token comment">//mSurfaceHolder.mSurface.copyFrom(mSurface);</span>
                mSurfaceHolder<span class="token punctuation">.</span>mSurface <span class="token operator">=</span> mSurface<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            mSurfaceHolder<span class="token punctuation">.</span><span class="token function">setSurfaceFrameSize</span><span class="token punctuation">(</span>mWidth<span class="token punctuation">,</span> mHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mSurfaceHolder<span class="token punctuation">.</span>mSurfaceLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>surfaceCreated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mSurfaceHolder<span class="token punctuation">.</span><span class="token function">ungetCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                mIsCreating <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token class-name">SurfaceHolder<span class="token punctuation">.</span>Callback</span><span class="token punctuation">[</span><span class="token punctuation">]</span> callbacks <span class="token operator">=</span> mSurfaceHolder<span class="token punctuation">.</span><span class="token function">getCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>callbacks <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SurfaceHolder<span class="token punctuation">.</span>Callback</span> c <span class="token operator">:</span> callbacks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        c<span class="token punctuation">.</span><span class="token function">surfaceCreated</span><span class="token punctuation">(</span>mSurfaceHolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>surfaceCreated <span class="token operator">||</span> surfaceReplaced <span class="token operator">||</span> surfaceSizeChanged
                    <span class="token operator">||</span> windowAttributesChanged<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> mSurface<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">SurfaceHolder<span class="token punctuation">.</span>Callback</span><span class="token punctuation">[</span><span class="token punctuation">]</span> callbacks <span class="token operator">=</span> mSurfaceHolder<span class="token punctuation">.</span><span class="token function">getCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>callbacks <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SurfaceHolder<span class="token punctuation">.</span>Callback</span> c <span class="token operator">:</span> callbacks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        c<span class="token punctuation">.</span><span class="token function">surfaceChanged</span><span class="token punctuation">(</span>mSurfaceHolder<span class="token punctuation">,</span> lp<span class="token punctuation">.</span>format<span class="token punctuation">,</span>
                                mWidth<span class="token punctuation">,</span> mHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                mIsCreating <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>surfaceDestroyed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">notifyHolderSurfaceDestroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                mSurfaceHolder<span class="token punctuation">.</span>mSurfaceLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    mSurfaceHolder<span class="token punctuation">.</span>mSurface <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Surface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    mSurfaceHolder<span class="token punctuation">.</span>mSurfaceLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">final</span> <span class="token class-name">ThreadedRenderer</span> threadedRenderer <span class="token operator">=</span> mAttachInfo<span class="token punctuation">.</span>mThreadedRenderer<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>threadedRenderer <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> threadedRenderer<span class="token punctuation">.</span><span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>hwInitialized
                    <span class="token operator">||</span> mWidth <span class="token operator">!=</span> threadedRenderer<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token operator">||</span> mHeight <span class="token operator">!=</span> threadedRenderer<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token operator">||</span> mNeedsRendererSetup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                threadedRenderer<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>mWidth<span class="token punctuation">,</span> mHeight<span class="token punctuation">,</span> mAttachInfo<span class="token punctuation">,</span>
                        mWindowAttributes<span class="token punctuation">.</span>surfaceInsets<span class="token punctuation">)</span><span class="token punctuation">;</span>
                mNeedsRendererSetup <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// TODO: In the CL &quot;ViewRootImpl: Fix issue with early draw report in</span>
        <span class="token comment">// seamless rotation&quot;. We moved processing of RELAYOUT_RES_BLAST_SYNC</span>
        <span class="token comment">// earlier in the function, potentially triggering a call to</span>
        <span class="token comment">// reportNextDraw(). That same CL changed this and the next reference</span>
        <span class="token comment">// to wasReportNextDraw, such that this logic would remain undisturbed</span>
        <span class="token comment">// (it continues to operate as if the code was never moved). This was</span>
        <span class="token comment">// done to achieve a more hermetic fix for S, but it's entirely</span>
        <span class="token comment">// possible that checking the most recent value is actually more</span>
        <span class="token comment">// correct here.</span>
        <span class="token comment">// 若窗口不处于停止状态或提交了下一次绘制</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mStopped <span class="token operator">||</span> wasReportNextDraw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 窗口触摸模式变化导致焦点控件变化检测</span>
            <span class="token keyword">boolean</span> focusChangedDueToTouchMode <span class="token operator">=</span> <span class="token function">ensureTouchModeLocally</span><span class="token punctuation">(</span>
                    <span class="token punctuation">(</span>relayoutResult<span class="token operator">&amp;</span><span class="token class-name">WindowManagerGlobal</span><span class="token punctuation">.</span>RELAYOUT_RES_IN_TOUCH_MODE<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// 检查是否需要重新测量 Activity 窗口大小</span>
            <span class="token comment">// 焦点控件由触摸模式变化而变化</span>
            <span class="token comment">// 或 测量出的顶层视图 host 大小与 WMS 计算出来的大小不同</span>
            <span class="token comment">// 或 边衬发生改变</span>
            <span class="token comment">// 或 配置发生改变（mPendingMergedConfiguration）</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>focusChangedDueToTouchMode <span class="token operator">||</span> mWidth <span class="token operator">!=</span> host<span class="token punctuation">.</span><span class="token function">getMeasuredWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token operator">||</span> mHeight <span class="token operator">!=</span> host<span class="token punctuation">.</span><span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> dispatchApplyInsets <span class="token operator">||</span>
                    updatedConfiguration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 重新计算 decorView 的 MeasureSpec</span>
                <span class="token keyword">int</span> childWidthMeasureSpec <span class="token operator">=</span> <span class="token function">getRootMeasureSpec</span><span class="token punctuation">(</span>mWidth<span class="token punctuation">,</span> lp<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> childHeightMeasureSpec <span class="token operator">=</span> <span class="token function">getRootMeasureSpec</span><span class="token punctuation">(</span>mHeight<span class="token punctuation">,</span> lp<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG_LAYOUT<span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span>mTag<span class="token punctuation">,</span> <span class="token string">&quot;Ooops, something changed!  mWidth=&quot;</span>
                        <span class="token operator">+</span> mWidth <span class="token operator">+</span> <span class="token string">&quot; measuredWidth=&quot;</span> <span class="token operator">+</span> host<span class="token punctuation">.</span><span class="token function">getMeasuredWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">+</span> <span class="token string">&quot; mHeight=&quot;</span> <span class="token operator">+</span> mHeight
                        <span class="token operator">+</span> <span class="token string">&quot; measuredHeight=&quot;</span> <span class="token operator">+</span> host<span class="token punctuation">.</span><span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">+</span> <span class="token string">&quot; dispatchApplyInsets=&quot;</span> <span class="token operator">+</span> dispatchApplyInsets<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Ask host how big it wants to be</span>
                <span class="token comment">//执行测量操作</span>
                <span class="token function">performMeasure</span><span class="token punctuation">(</span>childWidthMeasureSpec<span class="token punctuation">,</span> childHeightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Implementation of weights from WindowManager.LayoutParams</span>
                <span class="token comment">// We just grow the dimensions as needed and re-measure if</span>
                <span class="token comment">// needs be</span>
                <span class="token keyword">int</span> width <span class="token operator">=</span> host<span class="token punctuation">.</span><span class="token function">getMeasuredWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> height <span class="token operator">=</span> host<span class="token punctuation">.</span><span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">boolean</span> measureAgain <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

                <span class="token comment">// 在重新计算之后，若 Activity 窗口属性 lp 指明需要对测出的宽高扩展</span>
                <span class="token comment">// (即 lp 指向的 WindowManager.LayoutPrams 对象 horizontalWeight</span>
                <span class="token comment">// 和 verticalWeight 大于 0）</span>
                <span class="token comment">// 则对顶层视图 host 最大可用控件进行扩展后再测量一次</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>lp<span class="token punctuation">.</span>horizontalWeight <span class="token operator">&gt;</span> <span class="token number">0.0f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 测量宽度加上额外像素</span>
                    width <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mWidth <span class="token operator">-</span> width<span class="token punctuation">)</span> <span class="token operator">*</span> lp<span class="token punctuation">.</span>horizontalWeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 重新计算 MeasureSpec</span>
                    childWidthMeasureSpec <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">makeMeasureSpec</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span>
                            <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>EXACTLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 标记需要重新测量</span>
                    measureAgain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>lp<span class="token punctuation">.</span>verticalWeight <span class="token operator">&gt;</span> <span class="token number">0.0f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    height <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mHeight <span class="token operator">-</span> height<span class="token punctuation">)</span> <span class="token operator">*</span> lp<span class="token punctuation">.</span>verticalWeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    childHeightMeasureSpec <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">makeMeasureSpec</span><span class="token punctuation">(</span>height<span class="token punctuation">,</span>
                            <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>EXACTLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    measureAgain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                
                <span class="token comment">// 当标记需要重新测量，调用 performMeasure()</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>measureAgain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG_LAYOUT<span class="token punctuation">)</span> <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span>mTag<span class="token punctuation">,</span>
                            <span class="token string">&quot;And hey let's measure once more: width=&quot;</span> <span class="token operator">+</span> width
                            <span class="token operator">+</span> <span class="token string">&quot; height=&quot;</span> <span class="token operator">+</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">performMeasure</span><span class="token punctuation">(</span>childWidthMeasureSpec<span class="token punctuation">,</span> childHeightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                layoutRequested <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token comment">// 不是第一次遍历且各个参数都没有变化</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Not the first pass and no window/insets/visibility change but the window</span>
        <span class="token comment">// may have moved and we need check that and if so to update the left and right</span>
        <span class="token comment">// in the attach info. We translate only the window frame since on window move</span>
        <span class="token comment">// the window manager tells us only for the new frame but the insets are the</span>
        <span class="token comment">// same and we do not want to translate them more than once.</span>
        <span class="token comment">// 检查窗口发生移动情况</span>
        <span class="token function">maybeHandleWindowMove</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>surfaceSizeChanged <span class="token operator">||</span> surfaceReplaced <span class="token operator">||</span> surfaceCreated <span class="token operator">||</span> windowAttributesChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If the surface has been replaced, there's a chance the bounds layer is not parented</span>
        <span class="token comment">// to the new layer. When updating bounds layer, also reparent to the main VRI</span>
        <span class="token comment">// SurfaceControl to ensure it's correctly placed in the hierarchy.</span>
        <span class="token comment">//</span>
        <span class="token comment">// This needs to be done on the client side since WMS won't reparent the children to the</span>
        <span class="token comment">// new surface if it thinks the app is closing. WMS gets the signal that the app is</span>
        <span class="token comment">// stopping, but on the client side it doesn't get stopped since it's restarted quick</span>
        <span class="token comment">// enough. WMS doesn't want to keep around old children since they will leak when the</span>
        <span class="token comment">// client creates new children.</span>
        <span class="token function">prepareSurfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 调用布局和绘制流程</span>
    <span class="token comment">// Activity 测量结束，开始对其进行布局</span>
    <span class="token comment">// 请求了布局 且 窗口没有处于停止状态或提交了下一次绘制</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> didLayout <span class="token operator">=</span> layoutRequested <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>mStopped <span class="token operator">||</span> wasReportNextDraw<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> triggerGlobalLayoutListener <span class="token operator">=</span> didLayout
            <span class="token operator">||</span> mAttachInfo<span class="token punctuation">.</span>mRecomputeGlobalAttributes<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>didLayout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 开始布局流程</span>
        <span class="token function">performLayout</span><span class="token punctuation">(</span>lp<span class="token punctuation">,</span> mWidth<span class="token punctuation">,</span> mHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// By this point all views have been sized and positioned</span>
        <span class="token comment">// We can compute the transparent area</span>

        <span class="token comment">// 处理透明区域</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">.</span>mPrivateFlags <span class="token operator">&amp;</span> <span class="token class-name">View</span><span class="token punctuation">.</span>PFLAG_REQUEST_TRANSPARENT_REGIONS<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// start out transparent</span>
            <span class="token comment">// TODO: AVOID THAT CALL BY CACHING THE RESULT?</span>
            host<span class="token punctuation">.</span><span class="token function">getLocationInWindow</span><span class="token punctuation">(</span>mTmpLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mTransparentRegion<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>mTmpLocation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mTmpLocation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    mTmpLocation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> host<span class="token punctuation">.</span>mRight <span class="token operator">-</span> host<span class="token punctuation">.</span>mLeft<span class="token punctuation">,</span>
                    mTmpLocation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> host<span class="token punctuation">.</span>mBottom <span class="token operator">-</span> host<span class="token punctuation">.</span>mTop<span class="token punctuation">)</span><span class="token punctuation">;</span>

            host<span class="token punctuation">.</span><span class="token function">gatherTransparentRegion</span><span class="token punctuation">(</span>mTransparentRegion<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mTranslator <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mTranslator<span class="token punctuation">.</span><span class="token function">translateRegionInWindowToScreen</span><span class="token punctuation">(</span>mTransparentRegion<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mTransparentRegion<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mPreviousTransparentRegion<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mPreviousTransparentRegion<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>mTransparentRegion<span class="token punctuation">)</span><span class="token punctuation">;</span>
                mFullRedrawNeeded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token comment">// TODO: Ideally we would do this in prepareSurfaces,</span>
                <span class="token comment">// but prepareSurfaces is currently working under</span>
                <span class="token comment">// the assumption that we paused the render thread</span>
                <span class="token comment">// via the WM relayout code path. We probably eventually</span>
                <span class="token comment">// want to synchronize transparent region hint changes</span>
                <span class="token comment">// with draws.</span>
                <span class="token class-name">SurfaceControl</span> sc <span class="token operator">=</span> <span class="token function">getSurfaceControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>sc<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mTransaction<span class="token punctuation">.</span><span class="token function">setTransparentRegionHint</span><span class="token punctuation">(</span>sc<span class="token punctuation">,</span> mTransparentRegion<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>DBG<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;======================================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;performTraversals -- after setFrame&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            host<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// These callbacks will trigger SurfaceView SurfaceHolder.Callbacks and must be invoked</span>
    <span class="token comment">// after the measure pass. If its invoked before the measure pass and the app modifies</span>
    <span class="token comment">// the view hierarchy in the callbacks, we could leave the views in a broken state.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>surfaceCreated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">notifySurfaceCreated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>surfaceReplaced<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">notifySurfaceReplaced</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>surfaceDestroyed<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token function">notifySurfaceDestroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>triggerGlobalLayoutListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mAttachInfo<span class="token punctuation">.</span>mRecomputeGlobalAttributes <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        mAttachInfo<span class="token punctuation">.</span>mTreeObserver<span class="token punctuation">.</span><span class="token function">dispatchOnGlobalLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 通知 WMS Activity 有额外的边衬</span>
    <span class="token comment">// 处理边衬</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>computesInternalInsets<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Clear the original insets.</span>
        <span class="token keyword">final</span> <span class="token class-name">ViewTreeObserver<span class="token punctuation">.</span>InternalInsetsInfo</span> insets <span class="token operator">=</span> mAttachInfo<span class="token punctuation">.</span>mGivenInternalInsets<span class="token punctuation">;</span>
        <span class="token comment">// 重置边衬树，清空状态</span>
        insets<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 遍历计算 Activity 额外边衬</span>
        <span class="token comment">// Compute new insets in place.</span>
        mAttachInfo<span class="token punctuation">.</span>mTreeObserver<span class="token punctuation">.</span><span class="token function">dispatchOnComputeInternalInsets</span><span class="token punctuation">(</span>insets<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mAttachInfo<span class="token punctuation">.</span>mHasNonEmptyGivenInternalInsets <span class="token operator">=</span> <span class="token operator">!</span>insets<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Tell the window manager.</span>
        <span class="token comment">// 当 Activity 有额外边衬</span>
        <span class="token comment">// 或 额外边衬发生变化</span>
        <span class="token comment">// 设置额外边衬到 WMS 中</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>insetsPending <span class="token operator">||</span> <span class="token operator">!</span>mLastGivenInsets<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>insets<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mLastGivenInsets<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>insets<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 转换为屏幕坐标</span>
            <span class="token comment">// Translate insets to screen coordinates if needed.</span>
            <span class="token keyword">final</span> <span class="token class-name">Rect</span> contentInsets<span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token class-name">Rect</span> visibleInsets<span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token class-name">Region</span> touchableRegion<span class="token punctuation">;</span>
            <span class="token comment">// 若 mTranslator 指向了一个 Translator 对象说明 Activity 运行在兼容模式</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mTranslator <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 转换到兼容模式</span>
                contentInsets <span class="token operator">=</span> mTranslator<span class="token punctuation">.</span><span class="token function">getTranslatedContentInsets</span><span class="token punctuation">(</span>insets<span class="token punctuation">.</span>contentInsets<span class="token punctuation">)</span><span class="token punctuation">;</span>
                visibleInsets <span class="token operator">=</span> mTranslator<span class="token punctuation">.</span><span class="token function">getTranslatedVisibleInsets</span><span class="token punctuation">(</span>insets<span class="token punctuation">.</span>visibleInsets<span class="token punctuation">)</span><span class="token punctuation">;</span>
                touchableRegion <span class="token operator">=</span> mTranslator<span class="token punctuation">.</span><span class="token function">getTranslatedTouchableArea</span><span class="token punctuation">(</span>insets<span class="token punctuation">.</span>touchableRegion<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                contentInsets <span class="token operator">=</span> insets<span class="token punctuation">.</span>contentInsets<span class="token punctuation">;</span>
                visibleInsets <span class="token operator">=</span> insets<span class="token punctuation">.</span>visibleInsets<span class="token punctuation">;</span>
                touchableRegion <span class="token operator">=</span> insets<span class="token punctuation">.</span>touchableRegion<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 远程调用 WMS 将边衬设置到 WMS 中</span>
                mWindowSession<span class="token punctuation">.</span><span class="token function">setInsets</span><span class="token punctuation">(</span>mWindow<span class="token punctuation">,</span> insets<span class="token punctuation">.</span>mTouchableInsets<span class="token punctuation">,</span>
                        contentInsets<span class="token punctuation">,</span> visibleInsets<span class="token punctuation">,</span> touchableRegion<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RemoteException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>mFirst<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sAlwaysAssignFocus <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">isInTouchMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// handle first focus request</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG_INPUT_RESIZE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span>mTag<span class="token punctuation">,</span> <span class="token string">&quot;First: mView.hasFocus()=&quot;</span> <span class="token operator">+</span> mView<span class="token punctuation">.</span><span class="token function">hasFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mView<span class="token punctuation">.</span><span class="token function">hasFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mView<span class="token punctuation">.</span><span class="token function">restoreDefaultFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG_INPUT_RESIZE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span>mTag<span class="token punctuation">,</span> <span class="token string">&quot;First: requested focused view=&quot;</span> <span class="token operator">+</span> mView<span class="token punctuation">.</span><span class="token function">findFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG_INPUT_RESIZE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span>mTag<span class="token punctuation">,</span> <span class="token string">&quot;First: existing focused view=&quot;</span> <span class="token operator">+</span> mView<span class="token punctuation">.</span><span class="token function">findFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Some views (like ScrollView) won't hand focus to descendants that aren't within</span>
            <span class="token comment">// their viewport. Before layout, there's a good change these views are size 0</span>
            <span class="token comment">// which means no children can get focus. After layout, this view now has size, but</span>
            <span class="token comment">// is not guaranteed to hand-off focus to a focusable child (specifically, the edge-</span>
            <span class="token comment">// case where the child has a size prior to layout and thus won't trigger</span>
            <span class="token comment">// focusableViewAvailable).</span>
            <span class="token class-name">View</span> focused <span class="token operator">=</span> mView<span class="token punctuation">.</span><span class="token function">findFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>focused <span class="token keyword">instanceof</span> <span class="token class-name">ViewGroup</span>
                    <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ViewGroup</span><span class="token punctuation">)</span> focused<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDescendantFocusability</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token operator">==</span> <span class="token class-name">ViewGroup</span><span class="token punctuation">.</span>FOCUS_AFTER_DESCENDANTS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                focused<span class="token punctuation">.</span><span class="token function">restoreDefaultFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">final</span> <span class="token keyword">boolean</span> changedVisibility <span class="token operator">=</span> <span class="token punctuation">(</span>viewVisibilityChanged <span class="token operator">||</span> mFirst<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> isViewVisible<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> hasWindowFocus <span class="token operator">=</span> mAttachInfo<span class="token punctuation">.</span>mHasWindowFocus <span class="token operator">&amp;&amp;</span> isViewVisible<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> regainedFocus <span class="token operator">=</span> hasWindowFocus <span class="token operator">&amp;&amp;</span> mLostWindowFocus<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>regainedFocus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mLostWindowFocus <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasWindowFocus <span class="token operator">&amp;&amp;</span> mHadWindowFocus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mLostWindowFocus <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>changedVisibility <span class="token operator">||</span> regainedFocus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Toasts are presented as notifications - don't present them as windows as well</span>
        <span class="token keyword">boolean</span> isToast <span class="token operator">=</span> mWindowAttributes<span class="token punctuation">.</span>type <span class="token operator">==</span> TYPE_TOAST<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isToast<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            host<span class="token punctuation">.</span><span class="token function">sendAccessibilityEvent</span><span class="token punctuation">(</span><span class="token class-name">AccessibilityEvent</span><span class="token punctuation">.</span>TYPE_WINDOW_STATE_CHANGED<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 收尾工作</span>
    <span class="token comment">// 设置不是第一次请求遍历</span>
    mFirst <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    mWillDrawSoon <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    mNewSurfaceNeeded <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    mActivityRelaunched <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    mViewVisibility <span class="token operator">=</span> viewVisibility<span class="token punctuation">;</span>
    mHadWindowFocus <span class="token operator">=</span> hasWindowFocus<span class="token punctuation">;</span>

    mImeFocusController<span class="token punctuation">.</span><span class="token function">onTraversal</span><span class="token punctuation">(</span>hasWindowFocus<span class="token punctuation">,</span> mWindowAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Remember if we must report the next draw.</span>
    <span class="token comment">// 判断是否需要设置 mReortNextDraw, 为下一次遍历做准备</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>relayoutResult <span class="token operator">&amp;</span> <span class="token class-name">WindowManagerGlobal</span><span class="token punctuation">.</span>RELAYOUT_RES_FIRST_TIME<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reportNextDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 在第一次遍历时不会调用 performDraw(), 因为创建了新的 Surface</span>
    <span class="token comment">// 在 scheduleTraversals() 中会 post 一个 runnable</span>
    <span class="token comment">// 那时会再次调用 performDraw() 来执行绘制流程</span>
    <span class="token keyword">boolean</span> cancelDraw <span class="token operator">=</span> mAttachInfo<span class="token punctuation">.</span>mTreeObserver<span class="token punctuation">.</span><span class="token function">dispatchOnPreDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>isViewVisible<span class="token punctuation">;</span>
    <span class="token comment">// 若没有取消绘制</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cancelDraw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 若存在等待执行动画就遍历执行</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mPendingTransitions <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mPendingTransitions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mPendingTransitions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mPendingTransitions<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startChangingAnimations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            mPendingTransitions<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 开始绘制流程</span>
        <span class="token function">performDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 取消绘制</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 若可见，再次尝试遍历</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isViewVisible<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Try again</span>
            <span class="token function">scheduleTraversals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 若不可见</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 若存在等待执行动画就遍历执行</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mPendingTransitions <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mPendingTransitions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mPendingTransitions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mPendingTransitions<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endChangingAnimations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                mPendingTransitions<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// We may never draw since it's not visible. Report back that we're finished</span>
            <span class="token comment">// drawing.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>wasReportNextDraw <span class="token operator">&amp;&amp;</span> mReportNextDraw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mReportNextDraw <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token function">pendingDrawFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>mAttachInfo<span class="token punctuation">.</span>mContentCaptureEvents <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">notifyContentCatpureEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    mIsInTraversal <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br><span class="line-number">558</span><br><span class="line-number">559</span><br><span class="line-number">560</span><br><span class="line-number">561</span><br><span class="line-number">562</span><br><span class="line-number">563</span><br><span class="line-number">564</span><br><span class="line-number">565</span><br><span class="line-number">566</span><br><span class="line-number">567</span><br><span class="line-number">568</span><br><span class="line-number">569</span><br><span class="line-number">570</span><br><span class="line-number">571</span><br><span class="line-number">572</span><br><span class="line-number">573</span><br><span class="line-number">574</span><br><span class="line-number">575</span><br><span class="line-number">576</span><br><span class="line-number">577</span><br><span class="line-number">578</span><br><span class="line-number">579</span><br><span class="line-number">580</span><br><span class="line-number">581</span><br><span class="line-number">582</span><br><span class="line-number">583</span><br><span class="line-number">584</span><br><span class="line-number">585</span><br><span class="line-number">586</span><br><span class="line-number">587</span><br><span class="line-number">588</span><br><span class="line-number">589</span><br><span class="line-number">590</span><br><span class="line-number">591</span><br><span class="line-number">592</span><br><span class="line-number">593</span><br><span class="line-number">594</span><br><span class="line-number">595</span><br><span class="line-number">596</span><br><span class="line-number">597</span><br><span class="line-number">598</span><br><span class="line-number">599</span><br><span class="line-number">600</span><br><span class="line-number">601</span><br><span class="line-number">602</span><br><span class="line-number">603</span><br><span class="line-number">604</span><br><span class="line-number">605</span><br><span class="line-number">606</span><br><span class="line-number">607</span><br><span class="line-number">608</span><br><span class="line-number">609</span><br><span class="line-number">610</span><br><span class="line-number">611</span><br><span class="line-number">612</span><br><span class="line-number">613</span><br><span class="line-number">614</span><br><span class="line-number">615</span><br><span class="line-number">616</span><br><span class="line-number">617</span><br><span class="line-number">618</span><br><span class="line-number">619</span><br><span class="line-number">620</span><br><span class="line-number">621</span><br><span class="line-number">622</span><br><span class="line-number">623</span><br><span class="line-number">624</span><br><span class="line-number">625</span><br><span class="line-number">626</span><br><span class="line-number">627</span><br><span class="line-number">628</span><br><span class="line-number">629</span><br><span class="line-number">630</span><br><span class="line-number">631</span><br><span class="line-number">632</span><br><span class="line-number">633</span><br><span class="line-number">634</span><br><span class="line-number">635</span><br><span class="line-number">636</span><br><span class="line-number">637</span><br><span class="line-number">638</span><br><span class="line-number">639</span><br><span class="line-number">640</span><br><span class="line-number">641</span><br><span class="line-number">642</span><br><span class="line-number">643</span><br><span class="line-number">644</span><br><span class="line-number">645</span><br><span class="line-number">646</span><br><span class="line-number">647</span><br><span class="line-number">648</span><br><span class="line-number">649</span><br><span class="line-number">650</span><br><span class="line-number">651</span><br><span class="line-number">652</span><br><span class="line-number">653</span><br><span class="line-number">654</span><br><span class="line-number">655</span><br><span class="line-number">656</span><br><span class="line-number">657</span><br><span class="line-number">658</span><br><span class="line-number">659</span><br><span class="line-number">660</span><br><span class="line-number">661</span><br><span class="line-number">662</span><br><span class="line-number">663</span><br><span class="line-number">664</span><br><span class="line-number">665</span><br><span class="line-number">666</span><br><span class="line-number">667</span><br><span class="line-number">668</span><br><span class="line-number">669</span><br><span class="line-number">670</span><br><span class="line-number">671</span><br><span class="line-number">672</span><br><span class="line-number">673</span><br><span class="line-number">674</span><br><span class="line-number">675</span><br><span class="line-number">676</span><br><span class="line-number">677</span><br><span class="line-number">678</span><br><span class="line-number">679</span><br><span class="line-number">680</span><br><span class="line-number">681</span><br><span class="line-number">682</span><br><span class="line-number">683</span><br><span class="line-number">684</span><br><span class="line-number">685</span><br><span class="line-number">686</span><br><span class="line-number">687</span><br><span class="line-number">688</span><br><span class="line-number">689</span><br><span class="line-number">690</span><br><span class="line-number">691</span><br><span class="line-number">692</span><br><span class="line-number">693</span><br><span class="line-number">694</span><br><span class="line-number">695</span><br><span class="line-number">696</span><br><span class="line-number">697</span><br><span class="line-number">698</span><br><span class="line-number">699</span><br><span class="line-number">700</span><br><span class="line-number">701</span><br><span class="line-number">702</span><br><span class="line-number">703</span><br><span class="line-number">704</span><br><span class="line-number">705</span><br><span class="line-number">706</span><br><span class="line-number">707</span><br><span class="line-number">708</span><br><span class="line-number">709</span><br><span class="line-number">710</span><br><span class="line-number">711</span><br><span class="line-number">712</span><br><span class="line-number">713</span><br><span class="line-number">714</span><br><span class="line-number">715</span><br><span class="line-number">716</span><br><span class="line-number">717</span><br><span class="line-number">718</span><br><span class="line-number">719</span><br><span class="line-number">720</span><br><span class="line-number">721</span><br><span class="line-number">722</span><br><span class="line-number">723</span><br><span class="line-number">724</span><br><span class="line-number">725</span><br><span class="line-number">726</span><br><span class="line-number">727</span><br><span class="line-number">728</span><br><span class="line-number">729</span><br><span class="line-number">730</span><br><span class="line-number">731</span><br><span class="line-number">732</span><br><span class="line-number">733</span><br><span class="line-number">734</span><br><span class="line-number">735</span><br><span class="line-number">736</span><br><span class="line-number">737</span><br><span class="line-number">738</span><br><span class="line-number">739</span><br><span class="line-number">740</span><br><span class="line-number">741</span><br><span class="line-number">742</span><br><span class="line-number">743</span><br><span class="line-number">744</span><br><span class="line-number">745</span><br><span class="line-number">746</span><br><span class="line-number">747</span><br><span class="line-number">748</span><br><span class="line-number">749</span><br><span class="line-number">750</span><br><span class="line-number">751</span><br><span class="line-number">752</span><br><span class="line-number">753</span><br><span class="line-number">754</span><br><span class="line-number">755</span><br><span class="line-number">756</span><br><span class="line-number">757</span><br><span class="line-number">758</span><br><span class="line-number">759</span><br><span class="line-number">760</span><br><span class="line-number">761</span><br><span class="line-number">762</span><br><span class="line-number">763</span><br><span class="line-number">764</span><br><span class="line-number">765</span><br><span class="line-number">766</span><br><span class="line-number">767</span><br><span class="line-number">768</span><br><span class="line-number">769</span><br><span class="line-number">770</span><br><span class="line-number">771</span><br><span class="line-number">772</span><br><span class="line-number">773</span><br><span class="line-number">774</span><br><span class="line-number">775</span><br><span class="line-number">776</span><br><span class="line-number">777</span><br><span class="line-number">778</span><br><span class="line-number">779</span><br><span class="line-number">780</span><br><span class="line-number">781</span><br><span class="line-number">782</span><br><span class="line-number">783</span><br><span class="line-number">784</span><br><span class="line-number">785</span><br><span class="line-number">786</span><br><span class="line-number">787</span><br><span class="line-number">788</span><br><span class="line-number">789</span><br><span class="line-number">790</span><br><span class="line-number">791</span><br><span class="line-number">792</span><br><span class="line-number">793</span><br><span class="line-number">794</span><br><span class="line-number">795</span><br><span class="line-number">796</span><br><span class="line-number">797</span><br><span class="line-number">798</span><br><span class="line-number">799</span><br><span class="line-number">800</span><br><span class="line-number">801</span><br><span class="line-number">802</span><br><span class="line-number">803</span><br><span class="line-number">804</span><br><span class="line-number">805</span><br><span class="line-number">806</span><br><span class="line-number">807</span><br><span class="line-number">808</span><br><span class="line-number">809</span><br><span class="line-number">810</span><br><span class="line-number">811</span><br><span class="line-number">812</span><br><span class="line-number">813</span><br><span class="line-number">814</span><br><span class="line-number">815</span><br><span class="line-number">816</span><br><span class="line-number">817</span><br><span class="line-number">818</span><br><span class="line-number">819</span><br><span class="line-number">820</span><br><span class="line-number">821</span><br><span class="line-number">822</span><br><span class="line-number">823</span><br><span class="line-number">824</span><br><span class="line-number">825</span><br><span class="line-number">826</span><br><span class="line-number">827</span><br><span class="line-number">828</span><br><span class="line-number">829</span><br><span class="line-number">830</span><br><span class="line-number">831</span><br><span class="line-number">832</span><br><span class="line-number">833</span><br><span class="line-number">834</span><br><span class="line-number">835</span><br><span class="line-number">836</span><br><span class="line-number">837</span><br><span class="line-number">838</span><br><span class="line-number">839</span><br><span class="line-number">840</span><br><span class="line-number">841</span><br><span class="line-number">842</span><br><span class="line-number">843</span><br><span class="line-number">844</span><br><span class="line-number">845</span><br><span class="line-number">846</span><br><span class="line-number">847</span><br><span class="line-number">848</span><br><span class="line-number">849</span><br><span class="line-number">850</span><br><span class="line-number">851</span><br><span class="line-number">852</span><br><span class="line-number">853</span><br><span class="line-number">854</span><br><span class="line-number">855</span><br><span class="line-number">856</span><br><span class="line-number">857</span><br><span class="line-number">858</span><br><span class="line-number">859</span><br><span class="line-number">860</span><br><span class="line-number">861</span><br><span class="line-number">862</span><br><span class="line-number">863</span><br><span class="line-number">864</span><br><span class="line-number">865</span><br><span class="line-number">866</span><br><span class="line-number">867</span><br><span class="line-number">868</span><br><span class="line-number">869</span><br><span class="line-number">870</span><br><span class="line-number">871</span><br><span class="line-number">872</span><br><span class="line-number">873</span><br><span class="line-number">874</span><br><span class="line-number">875</span><br><span class="line-number">876</span><br><span class="line-number">877</span><br><span class="line-number">878</span><br><span class="line-number">879</span><br><span class="line-number">880</span><br><span class="line-number">881</span><br><span class="line-number">882</span><br><span class="line-number">883</span><br><span class="line-number">884</span><br><span class="line-number">885</span><br><span class="line-number">886</span><br><span class="line-number">887</span><br><span class="line-number">888</span><br><span class="line-number">889</span><br><span class="line-number">890</span><br><span class="line-number">891</span><br><span class="line-number">892</span><br><span class="line-number">893</span><br><span class="line-number">894</span><br><span class="line-number">895</span><br><span class="line-number">896</span><br><span class="line-number">897</span><br><span class="line-number">898</span><br><span class="line-number">899</span><br><span class="line-number">900</span><br><span class="line-number">901</span><br><span class="line-number">902</span><br><span class="line-number">903</span><br><span class="line-number">904</span><br><span class="line-number">905</span><br><span class="line-number">906</span><br><span class="line-number">907</span><br><span class="line-number">908</span><br><span class="line-number">909</span><br><span class="line-number">910</span><br><span class="line-number">911</span><br><span class="line-number">912</span><br><span class="line-number">913</span><br><span class="line-number">914</span><br><span class="line-number">915</span><br><span class="line-number">916</span><br><span class="line-number">917</span><br><span class="line-number">918</span><br><span class="line-number">919</span><br><span class="line-number">920</span><br><span class="line-number">921</span><br><span class="line-number">922</span><br><span class="line-number">923</span><br><span class="line-number">924</span><br><span class="line-number">925</span><br><span class="line-number">926</span><br><span class="line-number">927</span><br><span class="line-number">928</span><br><span class="line-number">929</span><br><span class="line-number">930</span><br><span class="line-number">931</span><br><span class="line-number">932</span><br><span class="line-number">933</span><br><span class="line-number">934</span><br><span class="line-number">935</span><br><span class="line-number">936</span><br><span class="line-number">937</span><br></div></div><h2 id="参考文献或资料"><a href="#参考文献或资料" class="header-anchor">#</a> 参考文献或资料</h2> <ol><li><a href="https://www.kancloud.cn/alex_wsc/androids/473778" target="_blank" rel="noopener noreferrer">计算Activity窗口大小的过程分析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/aecff29d6751" target="_blank" rel="noopener noreferrer">performTraversals()分析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ZweiRm/localhost-8080.github.io/edit/master/docs/framework/performTraversal.md" target="_blank" rel="noopener noreferrer">帮助我改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/9/1 17:48:34</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/framework/activity-launching-process.html" class="prev">
        Activity 启动流程
      </a></span> <span class="next"><a href="/framework/container.html">
        Android 12 容器层级
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><div></div></div></div>
    <script src="/assets/js/app.f18c4670.js" defer></script><script src="/assets/js/3.1fb3b4b2.js" defer></script><script src="/assets/js/27.62efc4a2.js" defer></script><script src="/assets/js/5.5d16e667.js" defer></script>
  </body>
</html>
